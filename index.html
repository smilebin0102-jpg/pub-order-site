<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>사람들 주점 주문 시스템</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    select, button { font-size: 16px; padding: 5px 10px; margin: 0.5rem 0; }
  </style>
</head>
<body>

  <h1>사람들 주점 주문하기</h1>

  <!-- ✅ 테이블 선택 드롭다운 -->
  <label for="tableSelect">테이블 번호:</label>
  <select id="tableSelect">
    <option value="">테이블 선택</option>
    <!-- 1~18번 자동 생성 -->
    ${Array.from({ length: 18 }, (_, i) => `<option value="${i + 1}">${i + 1}번</option>`).join('')}
  </select>

  <!-- ✅ 메뉴 예시 -->
  <h2>메뉴</h2>
  <div id="menu">
    <div>
      <span>제육볶음</span>
      <button onclick="addToCart('제육볶음', 18000)">추가</button>
    </div>
    <div>
      <span>파전</span>
      <button onclick="addToCart('파전', 12000)">추가</button>
    </div>
    <!-- 메뉴 더 추가 가능 -->
  </div>

  <!-- ✅ 장바구니 출력 -->
  <h3>주문내역</h3>
  <ul id="cartList"></ul>
  <p><strong>총액:</strong> <span id="totalPrice">0</span>원</p>
  <button onclick="placeOrder()">주문하기</button>

  <script>
    let cart = [];

    function addToCart(name, price) {
      const existing = cart.find(item => item.name === name);
      if (existing) {
        existing.quantity++;
      } else {
        cart.push({ name, price, quantity: 1 });
      }
      updateCartDisplay();
    }

    function updateCartDisplay() {
      const cartList = document.getElementById("cartList");
      const totalPrice = document.getElementById("totalPrice");
      cartList.innerHTML = '';
      let total = 0;
      cart.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.name} - ${item.quantity}개`;
        cartList.appendChild(li);
        total += item.price * item.quantity;
      });
      totalPrice.textContent = total;
    }

    function placeOrder() {
      const table = document.getElementById("tableSelect").value;
      if (!table) {
        alert("테이블 번호를 선택해주세요!");
        return;
      }

      if (cart.length === 0) {
        alert("주문 내역이 비어있습니다!");
        return;
      }

      const orderList = cart.map(item => `${item.name}-${item.quantity}`);
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

      // ✅ 여기에 Apps Script 배포 주소 넣기
      const scriptURL = "https://script.google.com/macros/s/AKfycbzvXDPDScmBIN-WLNeDnZ2XWjafjnbAlgVyCddY21wHlNMsBrCLuf6v7iPdYAgG_iSgcg/exec;

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify({
          table: table,
          orders: orderList,
          total: total
        }),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(res => {
        if (res.ok) {
          alert("주문이 완료되었습니다!");
          cart = [];
          updateCartDisplay();
          document.getElementById("tableSelect").value = "";
        } else {
          alert("전송 실패. 다시 시도해주세요.");
        }
      })
      .catch(err => {
        console.error(err);
        alert("에러가 발생했습니다.");
      });
    }
  </script>
</body>
</html>
